<!DOCTYPE html>
<html lang="pl">
<head>
    <link rel="stylesheet" href="assets/index.css">
    <link rel="icon" type="image/x-icon"
        href="https://play-lh.googleusercontent.com/_TNbiYKasPy_isTSEg2_UEzVaev4F8fO2lLunsHJ8_Ux2g3OzkSZyzpqvJG1woSj-WD4=w240-h480-rw">
    <title>mObywatel</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no">
</head>

<body>
    <script>
if (localStorage.getItem("loggedIn") !== "true") {
    window.location.href = "login.html";
}
</script>  
    <img src="https://play-lh.googleusercontent.com/_TNbiYKasPy_isTSEg2_UEzVaev4F8fO2lLunsHJ8_Ux2g3OzkSZyzpqvJG1woSj-WD4"
        class="logo">
    <p class="logo_text">uname</p>

    <div class="guide_holder">
        <div class="top_holder">
            <p class="guide_title">Instrukcja</p>
            <img class="arrow" src="https://i.imgur.com/aUZmu0W.png">
        </div>
        <div class="guide_text">
            <span style="font-size: 17px; font-weight: 500;">Dla systemu IOS:</span><br>
            <ul>
                <li>Upewnij siƒô, ≈ºe u≈ºywasz przeglƒÖdarki Safari</li>
                <li>Uzupe≈Çnij dane i kliknij wejd≈∫</li>
                <li>Naci≈õnij ‚ÄûUdostƒôpnij‚Äù ‚Üí ‚ÄûDo ekranu g≈Ç√≥wnego‚Äù</li>
            </ul>
            <span style="font-size: 17px; font-weight: 500;">Dla systemu Android:</span>
            <ul>
                <li>Upewnij siƒô, ≈ºe u≈ºywasz przeglƒÖdarki Google Chrome</li>
                <li>Uzupe≈Çnij dane i kliknij wejd≈∫</li>
                <li>Naci≈õnij 3 kropki ‚Üí ‚ÄûDodaj do ekranu g≈Ç√≥wnego‚Äù</li>
            </ul>
        </div>
    </div>

    <div class="upload">
        <p class="error">To pole jest wymagane</p>

        <div class="upload_grid">
            <img class="upload_image" id="preview" src="https://i.imgur.com/vwIQErh.png">
            <p class="upload_text">Wklej link z Imgur</p>
        </div>

        <input type="text" id="imgurLink" class="input" placeholder="https://i.imgur.com/TwojeZdjecie.jpg" style="margin-top: 10px; width: 100%;">
    </div>

    <!-- Pola formularza -->
    <div class="input_holder"><input type="text" id="name" class="input"><span class="placeholder">Imiƒô (imiona)</span></div>
    <div class="input_holder"><input type="text" id="surname" class="input"><span class="placeholder">Nazwisko</span></div>
    <div class="input_holder"><input type="text" id="sex" class="input"><span class="placeholder">P≈Çeƒá</span></div>
    <div class="input_holder"><input type="text" id="nationality" class="input"><span class="placeholder">Obywatelstwo</span></div>
    <div class="input_holder"><input type="text" id="birthday" class="input"><span class="placeholder">Data urodzenia (DD.MM.YYYY)</span></div>
    <div class="input_holder"><input type="text" id="familyName" class="input"><span class="placeholder">Nazwisko rodowe</span></div>
    <div class="input_holder"><input type="text" id="fathersFamilyName" class="input"><span class="placeholder">Nazwisko rodowe ojca</span></div>
    <div class="input_holder"><input type="text" id="mothersFamilyName" class="input"><span class="placeholder">Nazwisko rodowe matki</span></div>

    <p class="subtext">Miejsce zamieszkania</p>

    <div class="input_holder"><input type="text" id="birthPlace" class="input"><span class="placeholder">Miejsce urodzenia</span></div>
    <div class="input_holder"><input type="text" id="countryOfBirth" class="input"><span class="placeholder">Kraj urodzenia</span></div>
    <div class="input_holder"><input type="text" id="adress1" class="input"><span class="placeholder">Ulica i numer domu</span></div>
    <div class="input_holder"><input type="text" id="adress2" class="input"><span class="placeholder">Kod pocztowy</span></div>
    <div class="input_holder"><input type="text" id="city" class="input"><span class="placeholder">Miasto</span></div>
    <div class="input_holder"><input type="text" id="checkInDate" class="input"><span class="placeholder">Data zameldowania (DD.MM.YYYY)</span></div>

    <a class="go" id="goBtn">wejd≈∫</a>

    <script>
        const imgurInput = document.getElementById('imgurLink');
        const preview = document.getElementById('preview');
        const goBtn = document.getElementById('goBtn');

        function isValidImgur(link) {
            if (!link) return false;
            link = link.trim();
            return link.startsWith('https://i.imgur.com/') && (
                link.endsWith('.jpg') || link.endsWith('.jpeg') ||
                link.endsWith('.png') || link.endsWith('.gif')
            );
        }

        // podglƒÖd na ≈ºywo przy wpisywaniu
        imgurInput.addEventListener('input', () => {
            const link = imgurInput.value.trim();
            if (isValidImgur(link)) preview.src = link;
        });

        // automatyczne wczytanie ?photo=
        const params = new URLSearchParams(window.location.search);
        let photo = params.get('photo');

        if (photo) {
            photo = decodeURIComponent(photo); // üî• kluczowa poprawka
            if (isValidImgur(photo)) {
                imgurInput.value = photo;
                preview.src = photo;
            }
        }

        // po klikniƒôciu "wejd≈∫"
        goBtn.addEventListener('click', () => {
            const fields = [
                "name", "surname", "sex", "nationality", "birthday",
                "familyName", "fathersFamilyName", "mothersFamilyName",
                "birthPlace", "countryOfBirth", "adress1", "adress2",
                "city", "checkInDate"
            ];

            const newParams = new URLSearchParams();

            fields.forEach(f => {
                const val = document.getElementById(f).value.trim();
                if (val) newParams.append(f, val);
            });

            const photoLink = imgurInput.value.trim();
            if (isValidImgur(photoLink)) newParams.append('photo', photoLink);

            window.location.href = `card.html?${newParams.toString()}`;
        });
    </script>
<button onclick="logout()" 
    style="position: fixed; top: 15px; right: 15px; background: #ff4d4d; color: white; border: none; border-radius: 6px; padding: 8px 14px; cursor: pointer;">
    Wyloguj
</button>

<script>
function logout() {
    localStorage.removeItem("loggedIn");
    window.location.href = "login.html";
}
</script>
</body>
</html>

